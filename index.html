<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>about:blank Loader</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 60px;
    }
    input {
      width: 280px;
      padding: 10px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      margin-top: 12px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>about:blank Loader</h2>
<input id="siteInput" placeholder="Enter a URL (example.com)">
<button onclick="launch()">Go</button>

<script>
function launch() {
  let url = document.getElementById("siteInput").value.trim();
  if (!url) return;

  if (!url.startsWith("http://") && !url.startsWith("https://")) {
    url = "https://" + url;
  }

  let win = window.open("about:blank", "_blank");
  if (!win) {
    alert("Popup blocked. Allow popups for this site.");
    return;
  }

  fetch(url)
    .then(r => r.text())
    .then(html => {
      // Create a DOM so we can edit links
      let parser = new DOMParser();
      let doc = parser.parseFromString(html, "text/html");

      // Rewrite ALL links to stay inside the same about:blank tab
      doc.querySelectorAll("a[href]").forEach(a => {
        let href = a.getAttribute("href");
        if (href.startsWith("http")) {
          a.setAttribute("data-proxy-href", href);
          a.setAttribute("href", "#");
          a.onclick = () => {
            loadInBlank(win, href);
            return false;
          };
        }
      });

      // Write modified page to about:blank
      win.document.open();
      win.document.write("<!DOCTYPE html>" + doc.documentElement.outerHTML);
      win.document.close();

      // Inject a loader function into about:blank tab for future clicks
      win.loadInBlank = function(blankWindow, linkURL) {
        fetch(linkURL)
          .then(r => r.text())
          .then(innerHTML => {
            blankWindow.document.open();
            blankWindow.document.write(innerHTML);
            blankWindow.document.close();
          });
      };
    })
    .catch(err => {
      win.document.body.innerHTML = "<h2>Error loading site.</h2><p>" + err + "</p>";
    });
}
</script>

</body>
</html>
