<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Chloro Edition</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: #f4f6fa;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, sans-serif;
    }
    .centerbox {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 3px 32px #adbad933;
      padding: 32px 30px 28px 30px;
      text-align: center;
      min-width: 330px;
    }
    h2 {
      margin-top: 0;
      font-weight: 600;
      letter-spacing: 1px;
      color: #2544b1;
      font-size: 1.5rem;
    }
    input[type="text"] {
      width: 220px;
      padding: 11px 12px;
      border: 1.5px solid #d3dae6;
      border-radius: 8px;
      font-size: 15px;
      margin-right: 10px;
      outline: none;
      transition: border 0.1s;
    }
    input[type="text"]:focus {
      border: 1.7px solid #527dff;
    }
    button {
      background: #527dff;
      color: #fff;
      font-size: 15px;
      border: none;
      outline: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.18s;
    }
    button:hover {
      background: #2441b7;
    }
    .hint {
      margin-top: 14px;
      color: #98a6bc;
      font-size: 0.97em;
      letter-spacing: 0.2px;
    }
  </style>
</head>
<body>
  <div class="centerbox">
    <h2>The Chloro Edition</h2>
    <form id="urlForm" autocomplete="off" onsubmit="return false;">
      <input id="urlInput" type="text" spellcheck="false" placeholder="Enter website URL">
      <button id="goBtn" type="submit">Go</button>
    </form>
    <div class="hint">Fully client-side | Loads sites in about:blank</div>
  </div>
<script>
function normalizeURL(raw) {
  let u = raw.trim();
  if (!u) return "";
  // Add https:// if missing protocol and not a data: or about: url
  if (!/^https?:\/\//i.test(u) && !/^about:|^data:/i.test(u)) u = 'https://' + u;
  return u;
}

async function aboutblankCloak(url) {
  // Open blank tab immediately (avoids popup blockers)
  const win = window.open('about:blank', '_blank');
  if (!win) { alert("Popup blocked!"); return; }
  // Chain loader for navigation
  async function loadPage(href) {
    win.document.body.innerHTML = '<div style="text-align:center;margin-top:2.5em;font-family:sans-serif">Loading...<br><span style="font-size:44px;">‚è≥</span></div>';
    try {
      const resp = await fetch(href, { mode: 'cors' });
      if (!resp.ok) throw new Error("HTTP " + resp.status);
      const text = await resp.text();
      win.document.open();
      win.document.write(text);
      win.document.close();
      rewireLinks();
    } catch (e) {
      // Show popup and redirect the original tab to the URL
      alert("Failed to load the website in the embedded viewer due to CORS or blocking. You will be redirected to the original website.");
      window.location.href = href;
      try { win.close(); } catch {}
    }
  }
  // Intercept all links for same-tab loading
  function rewireLinks() {
    const anchors = win.document.querySelectorAll('a[href]');
    anchors.forEach(a => {
      a.addEventListener('click', function(ev) {
        const target = a.getAttribute('target');
        if (target && (target === "_blank" || target === "_top" || target === "_parent")) return;
        let href = a.href;
        if (!href || href.startsWith('javascript:') || href.startsWith('#') || href.startsWith('about:')) return;
        ev.preventDefault();
        loadPage(href);
      }, false);
    });
  }
  loadPage(url);
}

document.getElementById('goBtn').onclick = go;
document.getElementById('urlForm').onsubmit = go;

function go(e) {
  if (e) e.preventDefault?.();
  const url = normalizeURL(document.getElementById('urlInput').value);
  if (!url) return;
  aboutblankCloak(url);
  return false;
}
</script>
</body>
</html>
